<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><title>SONOTE - Cloud Edition</title><link href="https://fonts.googleapis.com/css2?family=Sawarabi+Gothic:wght@700&family=Jost:wght@900&display=swap" rel="stylesheet"><style>/* --- å…¨ä½“ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãƒ»ãƒ‡ã‚¶ã‚¤ãƒ³ --- */body{margin:0;font-family:"Sawarabi Gothic";font-weight:700;background:#fff;overflow:hidden;}header {
    font-family: "Jost"; 
    font-size: 34px; 
    padding: 12px 24px; 
    border-bottom: 1px solid #eee; 
    background: #fff;
    display: flex; 
    align-items: baseline; /* æ–‡å­—ã®ä¸‹ç«¯ã§æƒãˆã‚‹ */
    gap: 10px;             /* ãƒ­ã‚´ã¨ãƒ©ãƒ™ãƒ«ã®è·é›¢ */
}.sync-status {
    font-size: 10px; 
    font-family: "Sawarabi Gothic"; 
    padding: 2px 6px; 
    border-radius: 4px; 
    background: #f0f0f0;   /* è–„ã„ã‚°ãƒ¬ãƒ¼åœ° */
    color: #888;           /* æ¿ƒã„ã‚ã®ã‚°ãƒ¬ãƒ¼å­— */
    font-weight: 700;
    line-height: 1;
    transform: translateY(-2px); /* å³ä¸‹ã«æ²ˆã‚ã‚‹å¾®èª¿æ•´ */
}.layout{display:flex;height:calc(100vh - 70px);width: 100vw;}.left{width:15%; min-width:180px; border-right:1px solid #eee; padding:16px; background:#fafafa; overflow:auto; box-sizing: border-box;}.main{width:50%; min-width:350px; padding:28px; overflow:auto; border-right:1px solid #eee; box-sizing: border-box;}.right{width:35%; min-width:250px; padding:16px; background:#fcfcfc; overflow:auto; box-sizing: border-box;}/* UIè¦ç´  */.active-cat-title { text-align: left; font-size: 28px; margin-bottom: 24px; color: #333; border-left: 8px solid #f6f6f6; padding: 0 0 0 16px; line-height: 1.2; }.panel{background:#eee;border-radius:14px;padding:10px;margin-bottom:12px;display:flex;gap:8px; flex-wrap: wrap;}.addBtn{background:#555;color:#fff;border:none;border-radius:10px;padding:8px 12px;font-weight:700;cursor:pointer;}.mainBtn, .nameBtn, .saveNoteBtn, .folderBtn, .previewBtn { background:#fff; border:2px solid #000; border-radius:12px; padding:8px 14px; font-size:14px; font-weight:700; cursor:pointer; position:relative; text-align:left; font-family:inherit; display: flex; align-items: center; gap: 8px; word-break: break-all; white-space: normal; overflow-wrap: break-word; }.mainBtn { padding-right: 34px; margin: 4px; width: calc(100% - 8px); box-sizing: border-box;}/* çµµæ–‡å­—ãƒ”ãƒƒã‚«ãƒ¼ */.emoji-disp { font-size: 1.2em; cursor: pointer; transition: 0.2s; padding: 2px; border-radius: 4px; flex-shrink: 0; }.emoji-disp:hover { background: #eee; }.emoji-picker { position: absolute; top: 40px; left: 0; background: #fff; border: 2px solid #000; border-radius: 12px; padding: 8px; display: grid; grid-template-columns: repeat(4, 1fr); gap: 4px; z-index: 100; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }.emoji-item { cursor: pointer; font-size: 18px; text-align: center; padding: 4px; border-radius: 6px; }.emoji-item:hover { background: #eee; }.custom-emoji-area { grid-column: span 4; border-top: 1px solid #eee; padding-top: 8px; margin-top: 4px; display: flex; justify-content: center; }.custom-emoji-area input { width: 100% !important; padding: 6px !important; margin: 0 !important; text-align: center; font-size: 14px; height: 32px; border: 2px solid #ddd !important; }/* æ“ä½œãƒœã‚¿ãƒ³ï¼ˆãƒ›ãƒãƒ¼ã§è¡¨ç¤ºï¼‰ */.actionGroup { position:absolute; top:-8px; right:-8px; display:flex; flex-direction:column; gap:2px; opacity:0; transition:0.2s; z-index:20; }.mainBtn:hover .actionGroup, .nameBtn:hover .actionGroup, .folderBtn:hover .actionGroup, .previewBtn:hover .actionGroup, .fullContent-wrapper:hover .actionGroup, .term-wrapper:hover .actionGroup, .term-desc:hover .actionGroup, .fullContent:hover .actionGroup { opacity:1; }.miniBtn { padding:2px 6px; border:2px solid #000; background:#fff; border-radius:6px; font-size:14px; cursor:pointer; line-height:1.2; }.miniBtn:hover { background: #eee; }.active-cat { background: #f6f6f6 !important; border-color: #000; }.cat-item-wrapper { position: relative; margin-bottom: 12px; }.move-btns { display: flex; gap: 6px; padding-left: 8px; margin-top: 2px; }.arrowBtn { background: transparent; border: none; cursor: pointer; font-size: 16px; padding: 0 4px; color: #aaa; transition: 0.2s; }.arrowBtn:hover { color: #000; }/* ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ãƒ»ãƒ•ã‚©ãƒ«ãƒ€ãƒ»ãƒ¡ãƒ¢ */.folder{background:#f6f6f6; border:none; border-radius:16px; padding:14px; margin-bottom:12px; display: block; overflow: visible; cursor: grab;}.folderBtn { width: fit-content; max-width: 100%; display: flex; padding-right: 34px; margin-bottom:10px;}.nameBtn { width: fit-content; padding-right: 34px; display: inline-flex; align-items: center; max-width: 100%;}textarea,input{width:100%;border:2px solid #000;border-radius:12px;padding:8px;margin-top:6px;box-sizing:border-box;font-family:inherit;font-weight:700;}.inlineEdit { border:2px solid #000; border-radius:8px; padding:4px; font-weight:700; width:80%; margin:0; }.fullContent-wrapper { position: relative; width: 100%; margin: 8px 0; }.fullContent { font-size:14px; white-space:pre-wrap; border-left: 4px solid #000; padding: 4px 34px 4px 16px; cursor: pointer; min-height:1.2em; position:relative;}.previewBtn { width:100%; margin-top:4px; padding:8px 34px 8px 12px; font-size:13px; border:none; text-align: left;}.charRow{display:flex; flex-direction: column; gap:12px; margin-top:12px;}.charItem { position: relative; margin-bottom: 10px; }/* ç”¨èªé›† */.term-wrapper { margin-bottom: 12px; width: 100%; box-sizing: border-box; border-bottom: 1px solid #f0f0f0; padding-bottom: 8px; display: block; }.termBtn { width: auto; border: none; background: transparent; border-radius: 0; padding: 4px 0px; font-size: 15px; color: #333; display: block; text-align: left; }.term-desc { font-size: 14px; white-space: pre-wrap; border-left: 4px solid #000; padding: 0px 12px; margin: 4px 0 0 0; cursor: pointer; position: relative; line-height: 1.4; color: #444; font-weight: 700; text-align: left; display: block; width: fit-content; max-width: 100%; word-break: break-all; min-height: 0; }</style></head><body onclick="closeAllPickers()"><header>
    SONOTE
    <span id="header-status" class="sync-status">Connecting...</span></header><div class="layout">
    <div class="left"><div class="panel"><button class="addBtn" onclick="addCategory()">ï¼‹è¿½åŠ </button></div><div id="catList"></div></div>
    <div class="main" id="main" ondragover="initDragOver(event)"></div>
    <div class="right" id="glossary"></div></div><script type="module">import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";import { getFirestore, doc, setDoc, onSnapshot, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";const firebaseConfig = {
  apiKey: "AIzaSyDPYhwYgFtr5pp8PYjtUMfCP541NoAmmcM",
  authDomain: "sonote-cba11.firebaseapp.com",
  projectId: "sonote-cba11",
  storageBucket: "sonote-cba11.firebasestorage.app",
  messagingSenderId: "41068766709",
  appId: "1:41068766709:web:be0782bb13591ebc74acbc",
  measurementId: "G-GSFVSPG173"
};const app = initializeApp(firebaseConfig);const db = getFirestore(app);const docRef = doc(db, "users", "default_user");// ä¿å­˜é–¢æ•°window.save = async function() {
    try {
        await setDoc(docRef, { sonoteData: data }, { merge: true });
        document.getElementById('header-status').innerText = "Cloud Synced";
    } catch (e) {
        document.getElementById('header-status').innerText = "Sync Error";
    }
};// ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åŒæœŸonSnapshot(docRef, (docSnap) => {
    if (docSnap.exists()) {
        const cloudData = docSnap.data().sonoteData;
        if (JSON.stringify(data) !== JSON.stringify(cloudData)) {
            data = cloudData || [];
            render();
            document.getElementById('header-status').innerText = "Cloud";
        }
    }
});// åˆæœŸèµ·å‹•async function init() {
    const docSnap = await getDoc(docRef);
    if (docSnap.exists()) {
        data = docSnap.data().sonoteData || [];
    } else {
        const local = localStorage.getItem("sonote_emoji_v79");
        if (local) { data = JSON.parse(local); await window.save(); }
    }
    render();
}init();</script><script>/* --- Core App Logic --- */let data = [];let activeCatId = null;let addingItemFolderId = null;let activePickerId = null;let customAreaVisible = false;const EMOJI_LIST = ["ğŸ“","ğŸ“","ğŸ‘¤","ğŸ’¡","ğŸ”¥","â­","ğŸ”‘","ğŸŒˆ","ğŸ›¡ï¸","ğŸ§ª","ğŸ“œ","ğŸ—ºï¸","ğŸ­","ğŸ’","âŒ›"];function closeAllPickers(){ if(activePickerId !== null) { activePickerId = null; customAreaVisible = false; render(); } }function togglePicker(e, id){ e.stopPropagation(); activePickerId = (activePickerId === id) ? null : id; customAreaVisible = false; render(); }function toggleCustomArea(){ customAreaVisible = !customAreaVisible; render(); }function setEmoji(type, id, emoji){
    if(!emoji) return;
    if(type === 'cat'){
        const target = data.find(c => c.id === id);
        if(target) target.emoji = emoji;
    } else {
        const cat = data.find(c => c.id === activeCatId);
        if(cat){
            const folder = cat.folders.find(f => f.id === id);
            if(folder) folder.emoji = emoji;
        }
    }
    activePickerId = null; customAreaVisible = false; save(); render();
}function getEmojiPickerHtml(type, targetId, currentEmoji){
    return `<div class="emoji-picker" onclick="event.stopPropagation()">
        ${EMOJI_LIST.map(e => `<div class="emoji-item" onclick="setEmoji('${type}', ${targetId}, '${e}')">${e}</div>`).join("")}
        <div class="emoji-item" onclick="toggleCustomArea()">ï¼‹</div>
        ${customAreaVisible ? `<div class="custom-emoji-area"><input type="text" class="custom-input" maxlength="4" placeholder="Enter" onkeydown="if(event.key==='Enter') setEmoji('${type}', ${targetId}, this.value)" autofocus></div>` : ''}
    </div>`;
}function render(){
    // Left: Category List
    document.getElementById("catList").innerHTML = data.map((c, cIdx)=>`
        <div class="cat-item-wrapper">
            <button class="mainBtn ${c.id===activeCatId?'active-cat':''}" onclick="activeCatId=${c.id}; render();" ondblclick="event.stopPropagation(); data[${cIdx}].editing=true; render();">
                <span class="emoji-disp" onclick="togglePicker(event, ${c.id})">${c.emoji || 'ğŸ“'}</span>
                ${activePickerId === c.id ? getEmojiPickerHtml('cat', c.id, c.emoji) : ''}
                ${c.editing?`<input class="inlineEdit" value="${c.name}" onkeydown="if(event.key==='Enter'){data[${cIdx}].name=this.value; data[${cIdx}].editing=false; save(); render();}" onblur="data[${cIdx}].name=this.value; data[${cIdx}].editing=false; save(); render();" autofocus onclick="event.stopPropagation()">`:c.name}
                <div class="actionGroup"><div class="miniBtn" onclick="event.stopPropagation(); data = data.filter(x=>x.id!==${c.id}); if(activeCatId===${c.id}) activeCatId=null; save(); render();">ğŸ—‘</div></div>
            </button>
            <div class="move-btns">
                <button class="arrowBtn" onclick="let t=data[${cIdx}]; data[${cIdx}]=data[${cIdx}-1]; data[${cIdx}-1]=t; save(); render();" ${cIdx===0?'disabled':''}>â–²</button>
                <button class="arrowBtn" onclick="let t=data[${cIdx}]; data[${cIdx}]=data[${cIdx}+1]; data[${cIdx}+1]=t; save(); render();" ${cIdx===data.length-1?'disabled':''}>â–¼</button>
            </div>
        </div>`).join("");

    const mainContainer = document.getElementById("main");
    const glossaryContainer = document.getElementById("glossary");
    const cIdx = data.findIndex(c => c.id === activeCatId);
    if(cIdx === -1){ mainContainer.innerHTML="<p style='color:#ccc;text-align:center;margin-top:50px;'>ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã¾ãŸã¯è¿½åŠ ã—ã¦ãã ã•ã„</p>"; glossaryContainer.innerHTML=""; return; }
    let cat = data[cIdx];

    // Main: Folders & Notes
    mainContainer.innerHTML = `
        <div class="active-cat-title">${cat.name}</div>
        <div class="panel">
            <button class="addBtn" onclick="data[${cIdx}].folders.push({id:Date.now(),type:'char',name:'ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼',emoji:'ğŸ‘¤',editing:false,collapsed:false,notes:[],items:[]}); save(); render();">ï¼‹ã‚­ãƒ£ãƒ©</button>
            <button class="addBtn" onclick="data[${cIdx}].folders.push({id:Date.now(),type:'folder',name:'ãƒ•ã‚©ãƒ«ãƒ€',emoji:'ğŸ“',editing:false,collapsed:false,notes:[],items:[]}); save(); render();">ï¼‹ãƒ•ã‚©ãƒ«ãƒ€</button>
        </div>
        ${cat.folders.map((f, fIdx)=>`
            <div class="folder" data-id="${f.id}" style="${f.collapsed ? 'padding: 8px 14px; margin-bottom: 8px;' : ''}">
                <button class="folderBtn" style="${f.collapsed ? 'margin-bottom: 0px;' : ''}" onclick="data[${cIdx}].folders[${fIdx}].collapsed=!data[${cIdx}].folders[${fIdx}].collapsed; render();" ondblclick="event.stopPropagation(); data[${cIdx}].folders[${fIdx}].editing=true; render();">
                    <span class="emoji-disp" onclick="togglePicker(event, ${f.id})">${f.emoji || (f.type==='char'?'ğŸ‘¤':'ğŸ“')}</span>
                    ${activePickerId === f.id ? getEmojiPickerHtml('folder', f.id, f.emoji) : ''}
                    ${f.editing?`<input class="inlineEdit" value="${f.name}" onkeydown="if(event.key==='Enter'){data[${cIdx}].folders[${fIdx}].name=this.value; data[${cIdx}].folders[${fIdx}].editing=false; save(); render();}" onblur="data[${cIdx}].folders[${fIdx}].name=this.value; data[${cIdx}].folders[${fIdx}].editing=false; save(); render();" autofocus onclick="event.stopPropagation()">`:f.name}
                    <div class="actionGroup"><div class="miniBtn" onclick="event.stopPropagation(); data[${cIdx}].folders.splice(${fIdx},1); save(); render();">ğŸ—‘</div></div>
                </button>
                <div style="display:${f.collapsed?'none':'block'};">
                    <textarea id="note-input-${f.id}" placeholder="æ–°è¦ãƒ¡ãƒ¢ã‚’å…¥åŠ›..."></textarea>
                    <button class="saveNoteBtn" onclick="const v=document.getElementById('note-input-${f.id}').value; if(v){data[${cIdx}].folders[${fIdx}].notes.push({id:Date.now(),text:v,open:false,editing:false}); save(); render();}">ä¿å­˜</button>
                    <div style="margin-top:8px;">${f.notes.map((n, nIdx)=>`
                        <div class="fullContent-wrapper">
                            ${n.editing ? `<textarea onblur="data[${cIdx}].folders[${fIdx}].notes[${nIdx}].editing=false; data[${cIdx}].folders[${fIdx}].notes[${nIdx}].text=this.value; save(); render();" autofocus>${n.text}</textarea>` :
                            (!n.open?`<button class="previewBtn" onclick="data[${cIdx}].folders[${fIdx}].notes[${nIdx}].open=true; render();">${n.text.slice(0,30)}...</button>`:`<div class="fullContent" onclick="data[${cIdx}].folders[${fIdx}].notes[${nIdx}].open=false; render();">${n.text}</div>`)}
                            <div class="actionGroup"><div class="miniBtn" onclick="event.stopPropagation(); data[${cIdx}].folders[${fIdx}].notes.splice(${nIdx},1); save(); render();">ğŸ—‘</div><div class="miniBtn" onclick="event.stopPropagation(); data[${cIdx}].folders[${fIdx}].notes[${nIdx}].editing=true; render();">âœï¸</div></div>
                        </div>`).join("")}</div>
                    ${f.type==='char'?`<div style="margin-top:16px; border-top:1px solid #ddd; padding-top:10px;"><button class="addBtn" onclick="addingItemFolderId=(addingItemFolderId===${f.id}?null:${f.id}); render();">ï¼‹è©³ç´°è¨­å®š</button>
                        ${addingItemFolderId===f.id?`<div style="background:#eee;padding:10px;border-radius:12px;margin:8px 0;"><input id="new-name-${f.id}" placeholder="é …ç›®åï¼ˆå¹´é½¢ã€é­”æ³•ãªã©ï¼‰"><textarea id="new-text-${f.id}" placeholder="å†…å®¹"></textarea><button class="saveNoteBtn" onclick="const n=document.getElementById('new-name-${f.id}').value; const t=document.getElementById('new-text-${f.id}').value; data[${cIdx}].folders[fIdx].items.push({id:Date.now(),name:n,text:t,open:false}); addingItemFolderId=null; save(); render();">ä¿å­˜</button></div>`:''}
                        <div class="charRow">${f.items.map((i, iIdx)=>`<div class="charItem"><button class="nameBtn" onclick="i.open=!i.open; render();">${i.name}<div class="actionGroup"><div class="miniBtn" onclick="event.stopPropagation(); f.items.splice(${iIdx},1); save(); render();">ğŸ—‘</div></div></button>${i.open?`<div class="fullContent">${i.text}</div>`:''}</div>`).join("")}</div></div>`:""}
                </div>
            </div>`).join("")}`;

    // Right: Glossary
    if(!cat.glossary) cat.glossary = [];
    glossaryContainer.innerHTML = `<div style="font-size:20px;margin-bottom:16px;border-bottom:2px solid #eee;padding-bottom:8px;">ğŸ“– ç”¨èªé›†</div>
        <div style="background:#eee;padding:10px;border-radius:12px;margin-bottom:16px;"><input id="new-term-name" placeholder="ç”¨èªå"><textarea id="new-term-desc" placeholder="èª¬æ˜" style="height:50px;"></textarea><button class="addBtn" style="width:100%;margin-top:8px;" onclick="const n=document.getElementById('new-term-name').value; const d=document.getElementById('new-term-desc').value; if(n){cat.glossary.push({id:Date.now(),name:n,desc:d,open:false}); save(); render();}">è¿½åŠ </button></div>
        ${cat.glossary.map((t, tIdx)=>`<div class="term-wrapper"><button class="termBtn" onclick="t.open=!t.open; render();">${t.name}<div class="actionGroup"><div class="miniBtn" onclick="event.stopPropagation(); cat.glossary.splice(${tIdx},1); save(); render();">ğŸ—‘</div></div></button>${t.open?`<div class="term-desc">${t.desc}</div>`:''}</div>`).join("")}`;
}function addCategory(){ data.push({id:Date.now(),name:"æ–°è¦ã‚«ãƒ†ã‚´ãƒª",emoji:"ğŸ“",folders:[],glossary:[]}); save(); render(); }function initDragOver(e){ e.preventDefault(); } </script></body></html>
